https://cloud.google.com/architecture/chrome-desktop-remote-on-compute-engine


sudo apt-get update
sudo apt-get upgrade -y


apt install -y build-essential
sudo apt-get install -y wget curl lsb-release apt-transport-https software-properties-common


sudo apt-get install -y xfce4 xfce4-terminal
sudo apt install xfce4 xfce4-goodies


sudo apt-get install -y gnome-session gnome-terminal gdm3
sudo apt install -y gnome-control-center




wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
sudo dpkg -i google-chrome-stable_current_amd64.deb
sudo apt-get install -f -y


wget https://dl.google.com/linux/direct/chrome-remote-desktop_current_amd64.deb
sudo dpkg -i chrome-remote-desktop_current_amd64.deb
sudo apt-get install -f -y




ls /opt/google/chrome-remote-desktop/




sudo pkill -f chrome-remote-desktop


pkill -u googlebusiness -f chrome-remote-desktop


sudo apt-get install -y pavucontrol

sudo apt-get install -y pipewire-audio pipewire-pulse

apt install ubuntu-gnome-desktop





echo "exec /etc/X11/Xsession gnome-session" > ~/.chrome-remote-desktop-session



echo "exec /etc/X11/Xsession 'xfce4-session'" > ~/.chrome-remote-desktop-session





sudo apt update
sudo apt install qemu-kvm libvirt-daemon-system libvirt-clients bridge-utils virt-manager



sudo systemctl enable --now libvirtd
sudo systemctl status libvirtd


kvm-ok


sudo apt update
sudo apt install xorg


sudo apt install xserver-xorg xserver-xorg-core xserver-xorg-video-all xserver-xorg-input-all x11-xserver-utils



sudo apt update
sudo apt install dbus


sudo apt install dbus-x11


sudo systemctl enable dbus
sudo systemctl start dbus
sudo systemctl status dbus


dbus-launch


export DBUS_SESSION_BUS_ADDRESS
export DBUS_SESSION_BUS_PID


sudo apt install dbus dbus-x11 libdbus-1-3 libdbus-glib-1-2 libdbus-glib-1-dev libdbus-1-dev dbus-user-session


sudo systemctl enable --now dbus
sudo systemctl status dbus


sudo apt install tigervnc-standalone-server
vncserver :1

vncserver -kill :1


sudo systemctl set-default graphical.target


systemctl get-default


sudo systemctl start display-manager


sudo passwd googlebusiness






sudo apt update
sudo apt install -y xpra pulseaudio



sudo apt update
sudo apt install -y xpra ubuntu-gnome-desktop pulseaudio dbus-x11 x11-xserver-utils


http://YOUR_VM_IP:10000


xpra stop :100








nano ~/start-xpra-gnome.sh



#!/bin/bash
# Set resolution options
export CHROME_REMOTE_DESKTOP_DEFAULT_DESKTOP_SIZES=1920x1080,2560x1440

# Ensure PulseAudio is available
export PULSE_SERVER=unix:/run/user/$(id -u)/pulse/native

# Start Xpra with GNOME
xpra start :100 \
    --start-child="gnome-session" \
    --bind-tcp=0.0.0.0:10000 \
    --html=on \
    --daemon=no \
    --pulseaudio=yes






chmod +x ~/start-xpra-gnome.sh


~/start-xpra-gnome.sh





echo "export CHROME_REMOTE_DESKTOP_DEFAULT_DESKTOP_SIZES=1920x1080,2560x1440" > /home/googlebusiness/.chrome-remote-desktop-session
echo "export PULSE_SERVER=unix:/run/user/\$(id -u)/pulse/native" >> /home/googlebusiness/.chrome-remote-desktop-session
echo "exec /etc/X11/Xsession 'gnome-session'" >> /home/googlebusiness/.chrome-remote-desktop-session










sudo snap remove firefox
sudo add-apt-repository ppa:mozillateam/ppa -y
echo '
Package: firefox*
Pin: release o=LP-PPA-mozillateam
Pin-Priority: 501
' | sudo tee /etc/apt/preferences.d/mozilla-firefox

sudo apt update
sudo apt install firefox -y




sudo apt install at-spi2-core -y


sudo apt install -y gstreamer1.0-plugins-base gstreamer1.0-plugins-good \
                    gstreamer1.0-plugins-bad gstreamer1.0-plugins-ugly \
                    gstreamer1.0-libav





#!/bin/bash
# Force a clean environment
unset SESSION_MANAGER
unset DBUS_SESSION_BUS_ADDRESS

# Set resolution options
export CHROME_REMOTE_DESKTOP_DEFAULT_DESKTOP_SIZES=1920x1080,2560x1440

# Ensure PulseAudio is available
export PULSE_SERVER=unix:/run/user/$(id -u)/pulse/native

# Start Xpra with GNOME
xpra start :100 \
    --start-child="gnome-session --session=gnome-flashback-metacity" \
    --bind-tcp=0.0.0.0:10000 \
    --html=on \
    --daemon=no \
    --pulseaudio=yes






sudo apt update
sudo apt install -y ffmpeg \
    gstreamer1.0-libav \
    gstreamer1.0-plugins-base \
    gstreamer1.0-plugins-good \
    gstreamer1.0-plugins-bad \
    gstreamer1.0-plugins-ugly




sudo apt install -y python3-netifaces




sudo cp /usr/lib/python3/dist-packages/xpra/server/window/windowicon_source.py \
/usr/lib/python3/dist-packages/xpra/server/window/windowicon_source.py.bak









sudo tee /usr/lib/python3/dist-packages/xpra/server/window/windowicon_source.py <<'EOF'
from PIL import Image

# Compatibility for Pillow >=10
try:
    Resampling = Image.Resampling
except AttributeError:
    # Older Pillow versions
    class Resampling:
        LANCZOS = Image.ANTIALIAS

# ... rest of the xpra file unchanged ...

# Find the line:
# image = image.resize((rw, rh), Image.ANTIALIAS)
# Replace it with:
image = image.resize((rw, rh), Resampling.LANCZOS)
EOF









sudo sed -i.bak -e '/import PIL.Image/a\
try:\
    Resampling = Image.Resampling\
except AttributeError:\
    class Resampling:\
        LANCZOS = Image.ANTIALIAS
' /usr/lib/python3/dist-packages/xpra/server/window/windowicon_source.py

sudo sed -i 's/Image.ANTIALIAS/Resampling.LANCZOS/' /usr/lib/python3/dist-packages/xpra/server/window/windowicon_source.py





sudo rm -f /tmp/.X100-lock /tmp/.X11-unix/X100


ps aux | grep X



